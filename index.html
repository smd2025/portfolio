<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS | Intelligent Trading</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- TradingView Widget Script loaded lazily -->
</head>

<body>

    <!-- MOBILE MENU TOGGLE -->
    <button class="menu-toggle" id="btn-toggle">☰</button>

    <!-- SIDEBAR: CONFIGURATION -->
    <aside class="sidebar" id="sidebar">
        <div class="brand">
            <span>❖</span> <span style="letter-spacing: 4px; font-weight: 800;">NEXUS</span>
        </div>

        <div class="controls">
            <div class="form-group">
                <label>API Key (TwelveData)</label>
                <input type="password" id="apikey" class="input-field" placeholder="Ingrese Key..."
                    autocomplete="new-password">
            </div>

            <div class="form-group">
                <label>Modo de Mercado</label>
                <select id="mode">
                    <option value="real">API Real</option>
                    <option value="otc">API OTC</option>
                </select>
            </div>

            <div class="form-group">
                <label>Activos</label>
                <select id="pairs" multiple>
                    <!-- Populated dynamically by script.js -->
                </select>
            </div>

            <div class="form-group">
                <label>Historial (Días)</label>
                <input type="number" id="days" class="input-field" value="10" min="1" max="20">
            </div>

            <div class="form-group">
                <label>Ventana de Análisis (Horas)</label>
                <input type="number" id="hours" class="input-field" value="3" min="1" max="24">
            </div>

            <div class="form-group">
                <label>Confianza Mínima (%)</label>
                <input type="number" id="minConf" class="input-field" value="70" min="50" max="100">
            </div>

            <div class="form-group">
                <label>Offset Hora (UTC-3 Brasil)</label>
                <input type="number" id="offset" class="input-field" value="-3" step="1">
            </div>

            <button id="run" class="btn-primary">Ejecutar Escáner</button>
        </div>

        <div id="log" class="status-log">Esperando orden...</div>
    </aside>

    <!-- CONTENT: CHART & RESULTS -->
    <main class="main-content">
        <!-- CHART AREA WITH PLACEHOLDER -->
        <div class="chart-container" id="chart-area">
            <div class="chart-placeholder" id="placeholder-box">
                <div class="placeholder-card">
                    <h3>Mercado en Tiempo Real</h3>
                    <p>Conecta con TradingView para ver gráficos en vivo del mercado Forex. Esta función consume más
                        recursos.</p>
                    <button id="btn-chart" class="btn-primary" style="margin-top:0">Ver Gráfico</button>
                </div>
            </div>
        </div>

        <!-- RESULTS TABLE -->
        <div class="results-panel">
            <div class="panel-header">
                <div class="header-left">
                    <span>SEÑALES DETECTADAS</span>
                    <span id="signal-count" style="color: var(--accent); margin-left: 10px;">0 Señales</span>
                </div>
                <div class="header-actions">
                    <button id="btn-maximize" class="btn-icon" title="Maximizar/Minimizar">⛶</button>
                </div>
            </div>

            <!-- MULTI-PAIR SECTION (Only visible when maximized) -->
            <div id="multi-pair-container" class="multi-pair-bar">
                <div class="multi-pair-header">Configuración de Análisis Multi-Par</div>
                <div class="multi-pair-controls">
                    <div class="form-group-inline">
                        <label>Mercado</label>
                        <select id="multi-market-select">
                            <option value="real">API Real</option>
                            <option value="otc">API OTC</option>
                        </select>
                    </div>
                    <div id="multi-pair-list" class="multi-pair-list">
                        <!-- Dynamic pairs checkboxes -->
                    </div>
                    <button id="btn-run-multi" class="btn-primary"
                        style="margin: 0; padding: 8px 16px; width: auto;">Analizar Seleccionados</button>
                </div>
                <div id="multi-progress" class="multi-progress-text"></div>
            </div>

            <!-- TABS CONTAINER (Only visible when maximized and after analysis) -->
            <div id="tabs-container" class="tabs-nav">
                <!-- Dynamic tabs -->
            </div>

            <div class="table-container">
                <table id="signals-table">
                    <thead>
                        <tr>
                            <th>Hora</th>
                            <th>Par</th>
                            <th>Dir</th>
                            <th>Conf</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="results-body">
                        <!-- JS renders here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
</body>

</html>